!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["z-fetch"]={})}(this,(function(e){"use strict";let t={baseUrl:"",bearerToken:null,timeout:9e4,retry:!1,maxRetries:3,startPolling:!1,stopPolling:!1,pollingInterval:5e3,revalidateCache:1e4,withCredentials:!1,withCache:!0,parseJson:!0,stringifyPayload:!0,mode:"cors",headers:{"Content-Type":"application/json",Accept:"*/*"}};const n=/* @__PURE__ */new Map;async function a(e,a,r){const o=new AbortController,{signal:s}=o;let i=!0,l=null,c=null,u=0;const f=t.baseUrl?t.baseUrl+e:e,d=setTimeout((()=>{o.abort(),i=!1,l={message:"Request timed out!",status:"TIMEOUT"}}),t.timeout),h=async()=>{try{let e={signal:s,method:a,...t,...r,headers:{...t.headers,...r.headers}};t.stringifyPayload&&e.body&&"object"==typeof e.body&&(e.body=JSON.stringify(e.body));const n=await fetch(f,e);return n.ok?c=t.parseJson?await n.json():await n.text():l={message:n.statusText,status:n.status},clearTimeout(d),i=!1,{loading:i,error:l,data:c,response:n}}catch(e){return l={message:e.message,status:"NETWORK_ERROR"},clearTimeout(d),i=!1,{loading:i,error:l,data:c,response:null}}},T=`${a}:${f}`;if(t.withCache&&"GET"===a&&n.has(T))return setTimeout((()=>{h().then((e=>{e.error||n.set(T,e)}))}),t.revalidateCache),n.get(T);let y,g,p=await h();for(;t.retry&&u<t.maxRetries&&p.error;)u++,p=await h();t.withCache&&"GET"===a&&!p.error&&n.set(T,p);const b=()=>{y&&(clearInterval(y),y=null)},m=(e=t.pollingInterval)=>{g&&(y&&b(),y=setInterval((async()=>{try{const e=await h();g(e),Object.assign(p,e)}catch(e){}}),e))};return{...p,refetch:async e=>e(await h()),cancelRequest:()=>{o.abort()},startPolling:m,stopPolling:b,onPollDataReceived:e=>{if("function"!=typeof e)throw new Error("onPollDataReceived callback must be a function");g=e,t.startPolling&&!y&&m()}}}e.DELETE=function(e,t){return a(e,"DELETE",t)},e.GET=function(e,t){return a(e,"GET",t)},e.PATCH=function(e,t){return a(e,"PATCH",t)},e.POST=function(e,t){return a(e,"POST",t)},e.PUT=function(e,t){return a(e,"PUT",t)},e.setBearerToken=function(e){t.bearerToken=e,t.headers.Authorization=`Bearer ${e}`},e.setConfig=function(e){t={...t,...e}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
